<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Quáº£n lÃ½ Ä‘Äƒng nháº­p</title>
<style>
    body {
        font-family: Arial, sans-serif;
        background: linear-gradient(to right, #74ebd5, #ACB6E5);
        display: flex;
        justify-content: center;
        align-items: center;
        height: 100vh;
        margin: 0;
    }
    .container {
        background: white;
        padding: 30px;
        border-radius: 10px;
        box-shadow: 0 0 10px rgba(0,0,0,0.3);
        width: 350px;
        text-align: center;
    }
    h2 { color: #333; }
    input {
        width: 90%;
        padding: 10px;
        margin: 8px 0;
        border: 1px solid #ccc;
        border-radius: 5px;
    }
    button {
        background: #007bff;
        color: white;
        padding: 10px 15px;
        border: none;
        border-radius: 5px;
        cursor: pointer;
        margin: 5px;
    }
    button:hover { background: #0056b3; }
    .error { color: red; font-size: 14px; }
    .hidden { display: none; }
    #logoutBtn {
        position: absolute;
        top: 20px;
        right: 20px;
        background: #dc3545;
    }
    #userBtn {
        position: absolute;
        top: 20px;
        left: 20px;
        background: #28a745;
    }
    ul { text-align: left; }
</style>
</head>
<body>

<div class="container" id="loginPage">
    <h2>ÄÄ‚NG NHáº¬P</h2>
    <input type="text" id="loginUser" placeholder="TÃªn Ä‘Äƒng nháº­p"><br>
    <input type="password" id="loginPass" placeholder="Máº­t kháº©u"><br>
    <p class="error" id="loginError"></p>
    <button onclick="login()">ÄÄ‚NG NHáº¬P</button>
    <button onclick="showRegister()">ÄÄ‚NG KÃ</button>
</div>

<div class="container hidden" id="registerPage">
    <h2>ÄÄ‚NG KÃ</h2>
    <input type="text" id="regUser" placeholder="TÃªn Ä‘Äƒng nháº­p má»›i"><br>
    <input type="password" id="regPass" placeholder="Máº­t kháº©u"><br>
    <input type="password" id="regConfirm" placeholder="XÃ¡c nháº­n máº­t kháº©u"><br>
    <input type="email" id="regEmail" placeholder="Email"><br>
    <p class="error" id="regError"></p>
    <button onclick="register()">ÄÄ‚NG KÃ</button>
</div>

<div class="container hidden" id="shopPage">
    <h2>TRANG BÃN HÃ€NG</h2>
    <p>ChÃ o má»«ng báº¡n Ä‘áº¿n vá»›i cá»­a hÃ ng!</p>
    <button id="userBtn" onclick="showProfile()">ğŸ‘¤ TÃ i khoáº£n</button>
    <button id="logoutBtn" onclick="logout()">ÄÄ‚NG XUáº¤T</button>
</div>

<div class="container hidden" id="profilePage">
    <h2>THÃ”NG TIN KHÃCH HÃ€NG</h2>
    <label>Há»:</label><br>
    <input type="text" id="ho"><br>
    <label>TÃªn:</label><br>
    <input type="text" id="ten"><br>
    <label>Sá»‘ Ä‘iá»‡n thoáº¡i:</label><br>
    <input type="text" id="sdt"><br><br>
    <button onclick="saveProfile()">LÆ°u thÃ´ng tin</button><br><br>
    <button onclick="showPurchases()">DANH SÃCH MUA HÃ€NG</button><br><br>
    <button onclick="backToShop()">Quay láº¡i</button>
    <div id="purchaseList"></div>
</div>

<script>
    let currentUser = null;

    // ====== Tá»° Äá»˜NG ÄÄ‚NG NHáº¬P Náº¾U CÃ“ LÆ¯U TRÆ¯á»šC ÄÃ“ ======
    window.onload = function() {
        const savedUser = JSON.parse(localStorage.getItem("currentUser"));
        if (savedUser) {
            currentUser = savedUser;
            showShop();
        } else {
            showLogin();
        }
    };

    function showRegister() {
        document.getElementById("loginPage").classList.add("hidden");
        document.getElementById("registerPage").classList.remove("hidden");
    }

    function showLogin() {
        document.getElementById("registerPage").classList.add("hidden");
        document.getElementById("loginPage").classList.remove("hidden");
        document.getElementById("loginError").textContent = "";
    }

    function login() {
        const user = document.getElementById("loginUser").value;
        const pass = document.getElementById("loginPass").value;
        const storedUsers = JSON.parse(localStorage.getItem("users")) || [];

        const found = storedUsers.find(u => u.username === user && u.password === pass);

        if (found) {
            currentUser = found;
            localStorage.setItem("currentUser", JSON.stringify(currentUser)); // ğŸ”¥ LÆ°u ngÆ°á»i dÃ¹ng Ä‘Äƒng nháº­p
            showShop();
        } else {
            document.getElementById("loginError").textContent = "Sai thÃ´ng tin Ä‘Äƒng nháº­p";
        }
    }

    function register() {
        const user = document.getElementById("regUser").value;
        const pass = document.getElementById("regPass").value;
        const confirm = document.getElementById("regConfirm").value;
        const email = document.getElementById("regEmail").value;
        const error = document.getElementById("regError");
        error.textContent = "";

        if (pass !== confirm) {
            error.textContent = "Máº­t kháº©u xÃ¡c nháº­n khÃ´ng khá»›p!";
            return;
        }

        const storedUsers = JSON.parse(localStorage.getItem("users")) || [];
        if (storedUsers.some(u => u.username === user)) {
            error.textContent = "TÃªn Ä‘Äƒng nháº­p Ä‘Ã£ tá»“n táº¡i!";
            return;
        }

        const newUser = { username: user, password: pass, email: email, profile: {}, purchases: [] };
        storedUsers.push(newUser);
        localStorage.setItem("users", JSON.stringify(storedUsers));
        currentUser = newUser;
        localStorage.setItem("currentUser", JSON.stringify(currentUser)); // ğŸ”¥ LÆ°u ngÆ°á»i Ä‘Äƒng kÃ½ má»›i
        showShop();
    }

    function showShop() {
        document.getElementById("loginPage").classList.add("hidden");
        document.getElementById("registerPage").classList.add("hidden");
        document.getElementById("profilePage").classList.add("hidden");
        document.getElementById("shopPage").classList.remove("hidden");
    }

    function logout() {
        currentUser = null;
        localStorage.removeItem("currentUser"); // ğŸ§¹ XÃ³a dá»¯ liá»‡u ngÆ°á»i dÃ¹ng Ä‘ang Ä‘Äƒng nháº­p
        showLogin();
        document.getElementById("shopPage").classList.add("hidden");
    }

    function showProfile() {
        document.getElementById("shopPage").classList.add("hidden");
        document.getElementById("profilePage").classList.remove("hidden");

        document.getElementById("ho").value = currentUser.profile.ho || "";
        document.getElementById("ten").value = currentUser.profile.ten || "";
        document.getElementById("sdt").value = currentUser.profile.sdt || "";
    }

    function saveProfile() {
        currentUser.profile.ho = document.getElementById("ho").value;
        currentUser.profile.ten = document.getElementById("ten").value;
        currentUser.profile.sdt = document.getElementById("sdt").value;

        const users = JSON.parse(localStorage.getItem("users")) || [];
        const idx = users.findIndex(u => u.username === currentUser.username);
        users[idx] = currentUser;
        localStorage.setItem("users", JSON.stringify(users));
        localStorage.setItem("currentUser", JSON.stringify(currentUser)); // âœ… Cáº­p nháº­t cáº£ ngÆ°á»i Ä‘ang Ä‘Äƒng nháº­p

        alert("LÆ°u thÃ´ng tin thÃ nh cÃ´ng!");
    }

    function showPurchases() {
        const div = document.getElementById("purchaseList");
        div.innerHTML = "<h3>Danh sÃ¡ch mua hÃ ng:</h3>";
        if (currentUser.purchases.length === 0) {
            div.innerHTML += "<p>ChÆ°a cÃ³ Ä‘Æ¡n hÃ ng nÃ o.</p>";
        } else {
            const ul = document.createElement("ul");
            currentUser.purchases.forEach(item => {
                const li = document.createElement("li");
                li.textContent = item;
                ul.appendChild(li);
            });
            div.appendChild(ul);
        }
    }

    function backToShop() {
        document.getElementById("profilePage").classList.add("hidden");
        document.getElementById("shopPage").classList.remove("hidden");
        document.getElementById("purchaseList").innerHTML = "";
    }
</script>
</body>
</html>
